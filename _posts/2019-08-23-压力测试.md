---
layout: default
title:  "使用GitHub Pages结合Jekyll构建博客网站!"
categories: [java]
---
# JMeter 压力测试       
参考链接：https://www.jianshu.com/p/3cc4dd32a89a

## 为什么要做压力测试？

能够让开发人员在系统上线前能够了解到系统的承载能力，和当前、未来系统压力的提升情况，评估当前系统的承载情况能否满足当前和未来一段时间系统的正常运行。		

遇到大并发需求的活动或者其他突发时间导致的访问量暴增，能够提前做好预估和准备应急预案。

## 压力测试的难点？

压测环境不好申请，因为压测环境要和生产环境一致。意味着压测机器资源的稀缺，没有哪家公司会长期准备所有系统的压测环境，毕竟成本太高。

一般公司都是准备一些机器让所有系统共用压测环境，每次一个系统做压测之前，都要把生一个压测系统的数据和应用版本、中间件、数据库停掉或删掉，这是非常浪费时间的工作。

现在很多公司现在在压测的环境准备都使用docker来准备环境，只需要定期更新docker image就可以，这就可以做到快速还原环境，需要用到的时候直接把被测系统的docker image拉下来就行了。

<div style="display:flex;align-items:center;justify-content:center;">
    <img src="/img/2019-08-23-压力测试/001.png" width="706" height="838" />
</div>

## 压测数据的准备		
阿里云doom平台，[回流测试](https://yq.aliyun.com/articles/278811)		

如何能尽量真实的模拟生产的数据，最简单的就是录制一段时间生产的访问报文（使用JMeter结合badboy进行脚本录制，或者Jmeter录制录制脚本），然后再用压测环境进行正常回放和倍数回放。

## 压测指标

QPS：Query Per Second：每秒查询率，指的是服务器在单位时间内处理的查询请求速率。

TPS：Transaction Per Second：每秒事务处理数量，指的是服务器在单位时间内可以处理的事务数量。

PV：Page View：页面浏览量，通常是衡量一个页面甚至网站流量的重要指标，有多少人访问了你的网站。

RT：Response Time / Average Response Time：响应时间/平均响应时间，一个事务花费多长时间完成。

Througe out put : 吞吐量。同TPS

常用的压测指标主要是：用户并发量和TPS，一般这两个指标是一起使用的，就是在用户这么大的并发量的前提下tps是多少。		
如果有500个用户同时发起服务请求，服务端能够稳定正确处理的交易数量。		
一般来说，测试人员会统计一段时间生产环境里当前在线用户的会话数和接口当时被调用的次数，做个线性的乘数。通过这个乘数可以根据最后压测出的数据来评估系统大概能够承载的用户数量。

## 使用JMeter压测工具

### 基本概念：

1.	测试计划：使用JMeter进行测试的起点，是其他Jmeter测试元件的容器。
2.	
2.	线程组：代表一定数量的并发用户，可以用来模拟并发用户发送请求。线程组是为了模拟并发负载而设计。
3.	
3.	取样器：模拟各种请求。所有实际的测试任务都由取样器承担。如：http，ftp等等。
4.	
4.	监视器：负责收集测试结果。

5.	逻辑控制器：允许自定义JMeter发送请求的行为逻辑，与取样器结合使用可以模拟复杂的请求序列。
6.	
6.	断言：用来判断请求响应的结果是否如用户所期望，是否正确。它可以用来隔离问题域。在确保功能正确的前提下执行压力测试。
7.	
7.	定时器：负责定义请求之间的延迟间隔，模拟对服务器的连续请求。
8.	
8.	配置元件：维护取样器需要的配置信息，并根据实际的需要修改请求的内容。
9.	
9.	前置处理器和后置处理器：负责在生成请求之前和之后完成工作。前置处理器常常用来修改请求的设置，后置处理器则常常用来处理响应的数据。

### 测试报告分析：

<div style="display:flex;align-items:center;justify-content:center;">
    <img src="/img/2019-08-23-压力测试/002.png" width="760" height="196" />
</div>

1.	Error%:错误率允许在多大的范围内
2.	
2.	Throughput：吞吐量每秒请求的数大于并发数，则可以慢慢的往上面增加；若在压测的机器性能很好的情况下，出现吞吐量小于并发数，说明并发数不能再增加了，可以慢慢的往下减，找到最佳的并发数
3.	
3.	压测结束，登陆相应的web服务器查看CPU等性能指标，进行数据的分析;
4.	
4.	最大的tps:不断的增加并发数，加到tps达到一定值开始出现下降，那么那个值就是最大的tps
5.	
5.	最大的并发数：最大的并发数和最大的tps是不同的概率，一般不断增加并发数，达到一个值后，服务器出现请求超时，则可认为该值为最大的并发数。
6.	
6.	压测过程出现性能瓶颈，若压力机任务管理器查看到的cpu、网络和cpu都正常，未达到90%以上，则可以说明服务器有问题，压力机没有问题。
7.	
7.	影响性能考虑点包括：数据库、应用程序、中间件（tomact、Nginx）、网络和操作系统等方面。
8.	





